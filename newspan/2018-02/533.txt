The gunman had clearly prepared for the attack, Senator Bill Nelson of Florida said in an interview after speaking to the F.B.I.
“The shooter wore a gas mask, had smoke grenades, and he set off the fire alarm so the kids would come out of the classrooms,” said Mr. Nelson, citing details he learned from the F.B.I. Several students said they found it strange to hear the alarm, because they had already had a fire drill earlier in the day.
Sheriff Israel said he did not know the gunman’s motive. He said a football coach was among the dead, and the son of a deputy sheriff among the injured. Twelve of the 17 dead had been identified by Wednesday night, he added, noting that not all of the students had backpacks or wallets on them.
Jim Gard, a math teacher at the school, said Mr. Cruz was in his class in 2016 and appeared to be a “quiet” student. But Mr. Gard also recalled that “there was concern” about his behavior on the part of the school administration, which emailed teachers relaying those fears.
Mr. Gard said that after the shooting, he learned from several students that Mr. Cruz was obsessed with a girl at the school to the point of “stalking her,” a point the authorities did not raise in news briefings near the scene.
The massacre called to mind the country’s two mass shootings that have come to be known by the name of the schools: Columbine, the high school outside Denver where 12 students and a teacher were killed in 1999; and Sandy Hook, the elementary school in Newtown, Conn., where 20 students and six adults were shot dead in 2012.
More than 40 “active shooter” episodes in schools have been recorded in the United States since 2000, according to F.B.I. and news reports. Two 15-year-old students were killed and 18 more people were injured last month in a school in rural Benton, Ky. The shootings have become common enough that many schools, including Stoneman Douglas High, run annual drills in which students practice huddling in classrooms behind locked doors.
With the Parkland shooting, three of the 10 deadliest mass shootings in modern United States history have come in the last five months.
After the gunfire had stopped Wednesday afternoon and Mr. Cruz had fled, students ran out of the school, some in single file with their hands on the shoulders of those in front of them and others in all-out sprints. As the students sought cover, law enforcement officers armed with military-grade weapons swarmed the building. Parents rushed to a local Marriott hotel to reunite with their children.
“I tried to stay calm. Students were running everywhere,” said Dianna Milleret, a 16-year-old sophomore who heard the gunshots.
 The class was gathered just outside the building when she heard three distinct gunshots.
“I am in shock,” she said softly after clutching her mother, Cheryl Kaiser, on the sidewalk outside the school.
Seventeen patients were treated in three area hospitals, including two who died, said Dr. Evan Boyar of the Broward Health System. All suffered gunshot wounds.
Parkland, an affluent suburb of Fort Lauderdale with a population of about 30,000, is known for its good public schools. Stoneman Douglas High is among the largest in the Broward school district, with about 3,000 students. The school will remain closed for the rest of the week. Gov. Rick Scott directed the state to lower its flags at half-staff until Monday.
As the authorities frantically searched for the person responsible, they asked residents of the city to avoid the area around the school.
For hours, parents were lined along Coral Springs Drive, calling their children on cellphones and pacing. Some parents said their children told them only to text to not make noise. One parent of two daughters at a nearby middle school said he sat in a bank lobby near the school and prayed.
The gunfire came as some students were still staring at chalkboards and listening to lectures.
She couldn’t see her classmates fall, but she could see at least five were bleeding, one in the head and one in the leg. “I was trying to keep calm and my friend was holding my hand to keep it from shaking,” she said.
